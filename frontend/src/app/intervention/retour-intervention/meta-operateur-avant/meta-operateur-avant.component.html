<div class="full" *ngIf="prelevement.zoneIntervention.milieu === 0 || prelevement.zoneIntervention.milieu === 2">
  <div class="conditions">
    <div class="headerCondition">
      <label>Condition Ambiante</label>
      <div>Temp°</div>
      <div>Pression</div>
      <div>Humidité</div>
    </div>
    <div class="conditionContent">
      <label>Avant</label>
      <div>
        <input type="number" [(ngModel)]="prelevement.conditionTemperatureAvant" (ngModelChange)="checkPrelevement()" *ngIf="isEditable">
        <span *ngIf="!isEditable">{{prelevement.conditionTemperatureAvant}}</span>
      </div>
      <div>
        <input type="number" [(ngModel)]="prelevement.conditionPressionAvant" (ngModelChange)="checkPrelevement()" *ngIf="isEditable">
        <span *ngIf="!isEditable">{{prelevement.conditionPressionAvant}}</span>
      </div>
      <div>
        <input type="number" [(ngModel)]="prelevement.conditionHumiditeAvant" (ngModelChange)="checkPrelevement()" *ngIf="isEditable">
        <span *ngIf="!isEditable">{{prelevement.conditionHumiditeAvant}}</span>
      </div>
    </div>
  </div>
</div>
<div class="full" *ngIf="prelevement.zoneIntervention.milieu === 1 || prelevement.zoneIntervention.milieu === 2">
  <div class="meteoWrapper">
    <label>Métèo</label>
    <div class="meteo meteoHeader">
      <div class="pluis">
        <div>
          <i class="fas fa-sun"></i>
        </div>
        <div>
          <i class="fas fa-tint"></i>
        </div>
        <div>
          <i class="fas fa-tint"></i>
          <i class="fas fa-tint"></i>
        </div>
        <div>
          <i class="fas fa-tint"></i>
          <i class="fas fa-tint"></i>
          <i class="fas fa-tint"></i>
        </div>
      </div>
      <div>Dir. vent</div>
      <div>Vit. vent</div>
      <div>Temp.</div>
      <div>Humi.</div>
      <div>Pres.</div>
    </div>
  </div>
  <div class="meteoWrapper">
    <label>Avant</label>
    <div class="meteo">
      <div class="pluis">
        <div>
          <input type="radio" name="pluieAvant" [value]="enumPluie.AUCUNE" [(ngModel)]="prelevement.pluieAvant" (ngModelChange)="checkPrelevement()" *ngIf="isEditable">
          <span *ngIf="!isEditable"><i *ngIf="prelevement.pluieAvant === enumPluie.AUCUNE" class="fas fa-check"></i></span>
        </div>
        <div>
          <input type="radio" name="pluieAvant" [value]="enumPluie.FAIBLE" [(ngModel)]="prelevement.pluieAvant" (ngModelChange)="checkPrelevement()" *ngIf="isEditable">
          <span *ngIf="!isEditable"><i *ngIf="prelevement.pluieAvant === enumPluie.FAIBLE" class="fas fa-check"></i></span>
        </div>
        <div>
          <input type="radio" name="pluieAvant" [value]="enumPluie.MOYENNE" [(ngModel)]="prelevement.pluieAvant" (ngModelChange)="checkPrelevement()" *ngIf="isEditable">
          <span *ngIf="!isEditable"><i *ngIf="prelevement.pluieAvant === enumPluie.MOYENNE" class="fas fa-check"></i></span>
        </div>
        <div>
          <input type="radio" name="pluieAvant" [value]="enumPluie.FORTE" [(ngModel)]="prelevement.pluieAvant" (ngModelChange)="checkPrelevement()" *ngIf="isEditable">
          <span *ngIf="!isEditable"><i *ngIf="prelevement.pluieAvant === enumPluie.FORTE" class="fas fa-check"></i></span>
        </div>
      </div>
      <div>
        <select [(ngModel)]="prelevement.directionVentAvant" (ngModelChange)="checkPrelevement()" *ngIf="isEditable">
          <option value="N">N</option>
          <option value="NO">NO</option>
          <option value="O">O</option>
          <option value="SO">SO</option>
          <option value="S">S</option>
          <option value="SE">SE</option>
          <option value="E">E</option>
          <option value="NE">NE</option>
        </select>
        <span *ngIf="!isEditable">{{prelevement.directionVentAvant}}</span>
      </div>
      <div>
        <input type="number" [(ngModel)]="prelevement.vistesseVentAvant" (ngModelChange)="checkPrelevement()" *ngIf="isEditable">
        <span *ngIf="!isEditable">{{prelevement.vistesseVentAvant}}</span>
      </div>
      <div>
        <input type="number" [(ngModel)]="prelevement.temperatureAvant" (ngModelChange)="checkPrelevement()" *ngIf="isEditable">
        <span *ngIf="!isEditable">{{prelevement.temperatureAvant}}</span>
      </div>
      <div>
        <input type="number" [(ngModel)]="prelevement.humiditeAvant" (ngModelChange)="checkPrelevement()" *ngIf="isEditable">
        <span *ngIf="!isEditable">{{prelevement.humiditeAvant}}</span>
      </div>
      <div>
        <input type="number" [(ngModel)]="prelevement.pressionAvant" (ngModelChange)="checkPrelevement()" *ngIf="isEditable">
        <span *ngIf="!isEditable">{{prelevement.pressionAvant}}</span>
      </div>
    </div>
  </div>
</div>
<div class="affectation" *ngFor="let affectationPrelevement of prelevement.affectationsPrelevement">
  <div class="form">
    <div class="formgroup">
      <label>Pompe</label>
      <select [(ngModel)]="affectationPrelevement.pompe" (ngModelChange)="changePompe(affectationPrelevement, $event)" [compareWith]="compare" *ngIf="isEditable">
        <option *ngFor="let pompe of pompes" [ngValue]="pompe">{{pompe.libelle}}</option>
      </select>
      <div *ngIf="!isEditable">{{affectationPrelevement.pompe.libelle}}</div>
    </div>
    <div class="formgroup">
      <label>Filtre</label>
      <select [(ngModel)]="affectationPrelevement.filtre" (ngModelChange)="changeFiltre(affectationPrelevement, $event)" [compareWith]="compare" *ngIf="isEditable">
        <option *ngFor="let filtre of filtres" [ngValue]="filtre">{{filtre.ref}}</option>
      </select>
      <div *ngIf="!isEditable">{{affectationPrelevement.filtre.ref}}</div>
    </div>
    <div class="formgroup">
      <label>Debitmétre</label>
      <select [(ngModel)]="affectationPrelevement.idDebitmetre" *ngIf="isEditable">
        <option *ngFor="let debitmetre of debitmetres" [value]="debitmetre.id">{{debitmetre.libelle}}</option>
      </select>
      <div *ngIf="!isEditable">{{affectationPrelevement.debitmetre.ref}}</div>
    </div>
    <div class="formgroup noMobile">

    </div>
    <div class="formgroup">
      <label>Débit initial 1</label>
      <input type="number" [(ngModel)]="affectationPrelevement.debitInitial1" (change)="calcDebitInitial(affectationPrelevement)" *ngIf="isEditable">
      <div *ngIf="!isEditable">{{affectationPrelevement.debitInitial1}}</div>
    </div>
    <div class="formgroup">
      <label>Débit initial 2</label>
      <input type="number" [(ngModel)]="affectationPrelevement.debitInitial2" (change)="calcDebitInitial(affectationPrelevement)" *ngIf="isEditable">
      <div *ngIf="!isEditable">{{affectationPrelevement.debitInitial2}}</div>
    </div>
    <div class="formgroup">
      <label>Débit initial 3</label>
      <input type="number" [(ngModel)]="affectationPrelevement.debitInitial3" (change)="calcDebitInitial(affectationPrelevement)" *ngIf="isEditable">
      <div *ngIf="!isEditable">{{affectationPrelevement.debitInitial3}}</div>
    </div>
    <div class="formgroup">
      <label>Débit moyen initial</label>
      <div><span *ngIf="affectationPrelevement.debitMoyenInitial">{{affectationPrelevement.debitMoyenInitial}}</span></div>
    </div>
    <div *ngIf="affectationPrelevement.debitInitial1 && affectationPrelevement.debitInitial2 && affectationPrelevement.debitInitial3 &&
    (affectationPrelevement.debitMoyenInitial < 2.7 || affectationPrelevement.debitMoyenInitial > 3.3)" class="alert">
      Attention le debit n'est pas compris entre 2.7 et 3.3, il faut recalibrer votre Débitmètre.
    </div>
    <div class="formgroup full">
      <label>Opérateur</label>
      <input type="text" disabled
             value="{{affectationPrelevement?.operateurChantier?.nom}} - {{affectationPrelevement?.operateurChantier?.prenom}}">
      <i class="fas fa-user-plus" (click)="openModalContact(affectationPrelevement)" *ngIf="isEditable"></i>
    </div>
    <div class="formgroup" *ngIf="isEditable">
      <label>Date début</label>
      <input type="date" [(ngModel)]="affectationPrelevement.dateDebut" (change)="parseDateHeure(affectationPrelevement)">
    </div>
    <div class="formgroup" *ngIf="isEditable">
      <label>Heure début</label>
      <input type="time" [(ngModel)]="affectationPrelevement.heureDebut" (change)="parseDateHeure(affectationPrelevement)">
    </div>
    <div class="formgroup" *ngIf="!isEditable">
      <label>Date début</label>
      <div>Le {{affectationPrelevement.dateHeureDebut | date :'dd MMMM yyyy'}} à {{affectationPrelevement.dateHeureDebut | date :'hh:mm'}}</div>
    </div>
    <div class="formgroup full" *ngIf="isEditable && affectationPrelevement.commentaire">
      <label>Commentaire</label>
      <textarea [(ngModel)]="affectationPrelevement.commentaire" *ngIf="isEditable"></textarea>
      <div *ngIf="!isEditable">{{affectationPrelevement.commentaire}}</div>
    </div>
  </div>
  <div class="actionAffectation" *ngIf="isEditable">
    <i class="fas fa-trash pointer" *ngIf="prelevement.affectationsPrelevement.length > 1" (click)="deleteAffectation(affectationPrelevement)"></i>
  </div>
</div>
<div class="button" (click)="addAffectation()" *ngIf="isEditable">Créer nouvelle affectation</div>

<app-modal-contact *ngIf="modalContact" type="liste-contact" (emitClose)="closeModalContact()" (emitContact)="setContact($event)"></app-modal-contact>
